const WALLET_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/wallet",MINER_POOL_URL="https://eth.2miners.com/api/accounts/",PRICE_SERVICE_URL="https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD",REWARD_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/reward",PRICE_SERVICE_API_KEY="7c27660b903bfbbdf839cb1831998f2fa78b5ee701b165e12943a40c493024e7",WALLETS=[{createdAt:"2021-06-25T03:02:54.232Z",address:"13NknbGKvD79sNR1YjbvwvceNEEX82E9tP",name:"daulay",id:"1"},{createdAt:"2021-06-24T19:43:37.322Z",address:"16eoDJis8ELeL7R1vLPb2mzHZUJD6Q7tHT",name:"lcl",id:"2"},{createdAt:"2021-06-25T03:02:54.232Z",address:"0x866d5887f3585d24def05c19d6484ae6af49892e",name:"luanchuong",id:"3"},{createdAt:"2021-06-24T19:43:37.322Z",address:"14J3iotu2KfZAge3eSCdQrkL1G3uFgRA45",name:"tinEth",id:"4"},{createdAt:"2021-06-24T19:43:37.322Z",address:"19VniaW7vPGtDH3gs1SNAcawKUUcjQmftr",name:"tula",id:"5"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1321aJoCfS2BsFPmA1VAGrJ1rZ9GDbX6An",name:"daulay2",id:"6"},{createdAt:"2021-06-24T19:43:37.322Z",address:"186QMAbopPfZBzFqqdbSHVieoojnvhws9k",name:"thien1",id:"7"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1P2KYdCiqacTX9e2wE9zQxsZrPP1NxiSPY",name:"anhluan",id:"8"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1FU6C5mWwFCrcNYQ2EDfDjiJ6E255mdPvP",name:"nhat",id:"9"}];var vapp=new Vue({el:"#app",data:{wallets:[],price:0,miners:[],twallet:[],c:0,loadFailCounter:0},methods:{getEthPrice:function(){this.$http.get("https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD&api_key=7c27660b903bfbbdf839cb1831998f2fa78b5ee701b165e12943a40c493024e7").then(a=>{let b=a.body;this.price=b.USD},a=>{console.log(a)})},getAllWallet:function(){this.$http.get("https://5d073b61fa00250014577c37.mockapi.io/wallet").then(a=>{this.loadMiners(a.body)},a=>{this.loadMiners(WALLETS)})},formatNumber:function(a,b){return a.toFixed(b).replace(/\d(?=(\d{3})+\.)/g,"$&,")},formatNumber1:function(b,c){let a=b.toFixed(c).replace(/\d(?=(\d{3})+\.)/g,"$&,");for(;a.endsWith("0");)a=a.substring(0,a.length-1);return a},formatDateTime:function(a){let b=new Date(1e3*a);return moment(b).fromNow()},formatHashrate:function(a){let b=a/1e6;return b>=1e3?this.formatNumber(a/1e9,2)+" GH/s":this.formatNumber(b,1)+" MH/s"},formatWorkerHashrate:function(a){return this.formatNumber(a/1e6,0)},compare:function(a,b){return a.details.workersTotal>b.details.workersTotal?-1:a.details.workersTotal<b.details.workersTotal?1:a.id<b.id?-1:a.id>b.id?1:0},getTimestamp:function(){let a=new Date;return a.setHours(0,0,0,0),[moment(a).add(-1,"days").unix(),moment(a).unix(),moment(a).add(1,"days").unix(),]},getReward:function(a,b,c){return null==a?0:a.filter(a=>a.timestamp>=b&&a.timestamp<c).map(a=>a.reward).reduce((a,b)=>a+b,0)},getTodayReward:function(b){let a=this.getTimestamp();return this.getReward(b,a[1],a[2])},getYesterReward:function(b){let a=this.getTimestamp();return this.getReward(b,a[0],a[1])},loadMiners:function(a){this.c=0,this.twallet=[],a.forEach(b=>{this.$http.get("https://eth.2miners.com/api/accounts/"+b.address).then(d=>{let c=d.body;c.sumrewards.splice(3,0,{inverval:0,reward:this.getTodayReward(c.rewards),numreward:0,name:"Today",offset:0}),c.sumrewards.splice(4,0,{inverval:0,reward:this.getYesterReward(c.rewards),numreward:0,name:"Yesterday",offset:0}),this.twallet.push({id:b.id,name:b.name,address:b.address,details:c}),this.c==a.length-1-this.loadFailCounter&&(this.wallets=this.twallet.sort(this.compare),this.saveYesterdayReward()),this.c++},a=>{this.loadFailCounter++,console.log(a)})})},saveYesterdayReward:function(){let b=new Date;if(b.setHours(8,0,0,0),new Date<b)return;let c=localStorage.getItem("lastUpdate"),a=moment(new Date).add(-1,"days").format("DD/MM/YYYY");(null==c||c!=a)&&(this.$http.get(`${REWARD_SERVICE_URL}?date=${a}`).then(c=>{let d=c.body,b=this.wallets.filter(a=>d.every(b=>b.wallet!=a.address)).map(b=>({reward:this.getYesterReward(b.details.rewards),wallet:b.address,date:a}));b.length>0&&this.postReward(b)},a=>{console.log(a)}),localStorage.setItem("lastUpdate",a))},postReward:async function(b){for(let a=0;a<b.length;a++)await this.$http.post(REWARD_SERVICE_URL,b[a])},test:async function(){for(let a=0;a<10;a++){let b=await this.test1({name:a,avatar:`avatar${a}`});console.log(b),console.log(moment(new Date).format("YYYY-MM-DDTHH:mm:ss.SSS"))}},test1:async function(a){return await this.$http.post("https://5d073b61fa00250014577c37.mockapi.io/test",a)}},mounted:function(){this.getEthPrice(),this.getAllWallet()}});$(document).ready(function(){setInterval(function(){$("#autoUpdate").is(":checked")&&vapp.getAllWallet()},9e4)})