const WALLET_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/wallet",MINER_POOL_URL="https://eth.2miners.com/api/accounts/",PRICE_SERVICE_URL="https://min-api.cryptocompare.com/data/price?fsym=ETH&tsyms=USD",REWARD_SERVICE_URL="https://5d073b61fa00250014577c37.mockapi.io/reward",PRICE_SERVICE_API_KEY="7c27660b903bfbbdf839cb1831998f2fa78b5ee701b165e12943a40c493024e7",WALLETS=[{createdAt:"2021-06-25T03:02:54.232Z",address:"13NknbGKvD79sNR1YjbvwvceNEEX82E9tP",name:"daulay",id:"1"},{createdAt:"2021-06-24T19:43:37.322Z",address:"16eoDJis8ELeL7R1vLPb2mzHZUJD6Q7tHT",name:"lcl",id:"2"},{createdAt:"2021-06-25T03:02:54.232Z",address:"0x866d5887f3585d24def05c19d6484ae6af49892e",name:"luanchuong",id:"3"},{createdAt:"2021-06-24T19:43:37.322Z",address:"14J3iotu2KfZAge3eSCdQrkL1G3uFgRA45",name:"tinEth",id:"4"},{createdAt:"2021-06-24T19:43:37.322Z",address:"19VniaW7vPGtDH3gs1SNAcawKUUcjQmftr",name:"tula",id:"5"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1321aJoCfS2BsFPmA1VAGrJ1rZ9GDbX6An",name:"daulay2",id:"6"},{createdAt:"2021-06-24T19:43:37.322Z",address:"186QMAbopPfZBzFqqdbSHVieoojnvhws9k",name:"thien1",id:"7"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1P2KYdCiqacTX9e2wE9zQxsZrPP1NxiSPY",name:"anhluan",id:"8"},{createdAt:"2021-06-24T19:43:37.322Z",address:"1FU6C5mWwFCrcNYQ2EDfDjiJ6E255mdPvP",name:"nhat",id:"9"}];var vapp=new Vue({el:"#app",data:{wallets:[],price:0,miners:[],twallet:[],c:0,loadFailCounter:0},methods:{getEthPrice:function(){this.$http.get(PRICE_SERVICE_URL+"&api_key="+PRICE_SERVICE_API_KEY).then((t=>{let e=t.body;this.price=e.USD}),(t=>{console.log(t)}))},getAllWallet:function(){this.$http.get(WALLET_SERVICE_URL).then((t=>{this.loadMiners(t.body)}),(t=>{this.loadMiners(WALLETS)}))},formatNumber:function(t,e){return t.toFixed(e).replace(/\d(?=(\d{3})+\.)/g,"$&,")},formatNumber1:function(t,e){let a=t.toFixed(e).replace(/\d(?=(\d{3})+\.)/g,"$&,");for(;a.endsWith("0");)a=a.substring(0,a.length-1);return a},formatDateTime:function(t){let e=new Date(1e3*t);return moment(e).fromNow()},formatHashrate:function(t){let e=t/1e6;return e>=1e3?this.formatNumber(t/1e9,2)+" GH/s":this.formatNumber(e,1)+" MH/s"},formatWorkerHashrate:function(t){let e=t/1e6;return this.formatNumber(e,0)},compare:function(t,e){return t.details.workersTotal>e.details.workersTotal?-1:t.details.workersTotal<e.details.workersTotal?1:t.id<e.id?-1:t.id>e.id?1:0},getTimestamp:function(){let t=new Date;return t.setHours(0,0,0,0),[moment(t).add(-1,"days").unix(),moment(t).unix(),moment(t).add(1,"days").unix()]},getReward:function(t,e,a){return null==t?0:t.filter((t=>t.timestamp>=e&&t.timestamp<a)).map((t=>t.reward)).reduce(((t,e)=>t+e),0)},getTodayReward:function(t){let e=this.getTimestamp();return this.getReward(t,e[1],e[2])},getYesterReward:function(t){let e=this.getTimestamp();return this.getReward(t,e[0],e[1])},loadMiners:function(t){this.c=0,this.twallet=[],this.loadFailCounter=0,t.forEach((e=>{this.$http.get(MINER_POOL_URL+e.address).then((a=>{let r=a.body;r.sumrewards.splice(3,0,{inverval:0,reward:this.getTodayReward(r.rewards),numreward:0,name:"Today",offset:0}),r.sumrewards.splice(4,0,{inverval:0,reward:this.getYesterReward(r.rewards),numreward:0,name:"Yesterday",offset:0}),this.twallet.push({id:e.id,name:e.name,address:e.address,details:r}),this.c==t.length-1-this.loadFailCounter&&(this.wallets=this.twallet.sort(this.compare),console.log(this.wallets.map((t=>t.details.workersTotal)))),this.c++}),(t=>{this.loadFailCounter++}))}))},saveYesterdayReward:function(){let t=new Date;if(t.setHours(8,0,0,0),new Date<t)return;let e=localStorage.getItem("lastUpdate"),a=moment(new Date).add(-1,"days").format("DD/MM/YYYY");null!=e&&e==a||(this.$http.get(`${REWARD_SERVICE_URL}?date=${a}`).then((t=>{let e=t.body,r=this.wallets.filter((t=>e.every((e=>e.wallet!=t.address)))).map((t=>({reward:this.getYesterReward(t.details.rewards),wallet:t.address,date:a})));r.length>0&&this.postReward(r)}),(t=>{console.log(t)})),localStorage.setItem("lastUpdate",a))},postReward:async function(t){for(let e=0;e<t.length;e++){await this.$http.post(REWARD_SERVICE_URL,t[e])}},test:async function(){for(let t=0;t<10;t++){let e=await this.test1({name:t,avatar:`avatar${t}`});console.log(e),console.log(moment(new Date).format("YYYY-MM-DDTHH:mm:ss.SSS"))}},test1:async function(t){return await this.$http.post("https://5d073b61fa00250014577c37.mockapi.io/test",t)}},mounted:function(){this.getEthPrice(),this.getAllWallet()}});$(document).ready((function(){setInterval((function(){$("#autoUpdate").is(":checked")&&vapp.getAllWallet()}),9e4)}));